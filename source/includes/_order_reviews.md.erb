# Отзыв на заказ

## Получение списка заказов без отзывов

```shell
curl "<%= config[:host] %>/orders/unrated" \
  -H "Authorization: Token token=#{TOKEN}"
```

Получить список заказов без отзывов можно, выполнив запрос:

`GET <%= config[:host] %>/orders/unrated`

Запрос вернет заказы, завершеные не позднее 10 дней назад

## Создание отзыва

```shell
curl "<%= config[:host] %>/orders/C36324/reviews" \
  -H "Authorization: Token token=#{TOKEN}" \
  -d review[rate]=2 \
  -d review[comment]='В коробку с заказом пролился отбеливатель' \
  -d review[order_errors_attributes][][error_flag_id]=4 \
  -d review[order_errors_attributes][][line_item_ids]=[1, 2] \
  -X POST
```

> Ответ будет содержать следующие данные:

```json
{
  "review": {
    "rate": 2,
    "comment": "В коробку с заказом пролился отбеливатель",
    "order_errors": [
      {
        "error_comment": nil,
        "error_flag": {
          "id": "4",
          "name": "Неверный товар"
        }
      }
    ]
  }
}
```

Добавить отзыв к заказу можно, выполнив запрос:

`POST <%= config[:host] %>/orders/#{ORDER_NUMBER}/reviews`

Все ошибки заказов должны лежать в параметре `order_errors_attributes`
У каждой ошибки обязательный полем является поле `error_flag_id`
Дополнительный полем является либо поле `line_item_ids`, либо `error_comment`

Параметр | Обязательный | Описание
--------- | ------- | -----------
review[rate] | Да | Оценка
review[comment] | - | Комментарий
review[order_errors_attributes][][error_flag_id] | Да | ID флага ошибки
review[order_errors_attributes][][line_item_ids] | - | массив ID позиций заказа с проблемой
review[order_errors_attributes][][error_comment] | - | Комментарий проблемы

### Структура объекта Review

Атрибут | Описание
--------- | -----------
rate | оценка
comment | комментарий к оценке
order_errors_attributes | массив ошибок заказа

### Структура объекта OrderError

Атрибут | Описание
--------- | -----------
error_flag | Объект флага ошибки
error_comment | комментарий проблемы

## Получение списка флагов ошибок

```shell
curl "https://api.instamart.ru/v2/orders/error_flags"
```
> Эта комманда возвращает следующий JSON:

```json
[
  {
    "error_flags": [
      {
        "id": 4,
        "name": "Неверный товар"
      },
      {
        "id": 5,
        "name": "Товар отсутствует"
      },
      {
        "id": 6,
        "name": "Товар поврежден"
      },
      {
        "id": 7,
        "name": "Неверная замена"
      },
      {
        "id": 8,
        "name": "Другое"
      }
    ]
  }
]
```

Список всех возможных флагов ошибок заказа можно загрузить, выполнив запрос:

`GET https://api.instamart.ru/v2/error_flags`

Используется при [создании отзыва с ошибкой](#sozdaniie-otzyva)

### Структура объекта ErrorFlag

Атрибут | Описание
--------- | -----------
id | ID флага который надо использовать при создании ошибки
name | локализованное название
