# Продукты

## Список продуктов

```shell
curl "<%= config[:host] %>/products?sid=1&tid=187"
```

> Команда выше возвращает JSON:

```json
{
  "products": [
    {
      "id": 1,
      "sku": 100000,
      "name": "Бананы",
      "price": 54.79,
      "original_price": 55.79,
      "discount": 1.0,
      "weight": 500.0,
      "human_volume": "500 г.",
      "items_per_pack": 1,
      "description": "Бананы желтые из Эквадора",
      "images": [
        {
          "mini_url": "http://instamart.ru/products/1/mini/file.png",
          "small_url": "http://instamart.ru/products/1/small/file.png",
          "product_url": "http://instamart.ru/products/1/product/file.png"
        }
      ]
    }
  ],

  "facets": [{
    "key": "brand",
    "name": "Бренд",
    "type": "select",
    "options": [
      {
        "name": "Ahmad Tea",
        "value": 1,
        "active": false
      }
    ]
  }, {
    "key": "property",
    "name": "Вид чая",
    "type": "multi_select",
    "options": [
      {
        "name": "Белый чай",
        "value": 2,
        "active": false
      },
      {
        "name": "Зеленый чай",
        "value": 3,
        "active": false
      }
    ]
  }],

  "meta": {
    "current_page": 1,
    "next_page": null,
    "total_pages": 1
  }
}
```

> Пример запроса с фильтрацией выборки продуктов:

```shell
curl "<%= config[:host] %>/products?sid=1&filter[brand][]=1filter[property][]=4&filter[property][]=7"
```

Получить список продуктов доступных в текущий момент в Instamart можно, выполнив запрос:

### HTTP запрос

`GET <%= config[:host] %>/products`

API ограничивает максимальное число возвращаемых продуктов 24 объектами. Для доступа к остальным продуктам реализован интерфейс пагинации.
Каждый запрос к `/v2/products` помимо самих продуктов также возвращает объект `meta`, указывающий номер текущей страницы, номер следующей страницы и общее количество страниц. Получить конкретную страницу с данными можно, указав параметр `page`.

### Структура ответа

Объект | Описание
--------- | -----------
products | Список продуктов
facets | Список фасетов для фильтрации списка продуктов
meta | Атрибуты пагинации

### Структура объекта Facet

API продуктов поддерживает фасетную фильтрацию списка продуктов. То есть выборка продуктов может быть уменьшена путем применения одного или нескольких фасетных фильтров. Данные необходимые для корректного отображения фасета хранятся в объекте Facet.

Атрибут | Описание
--------- | -----------
key | Имя параметра в запросе
name | Название фасета
type | Тип, определяющий вид контрола: селект, мультиселект, интервал и т.п.
options | Список значений фасета для фильтрации

На данный момент доступны следующие типы фасетов:

Тип | Описание
----- | ------
select | Выбор одного значение из множества
multi_select | Выбор множества значений

### Фильтрация продуктов

Фильтрация списка продуктов выполняется передачей значения фасета в параметрах запроса.

Название параметра запроса формируется по шаблону `filter[#{FACET_KEY}][]`, где `FACET_KEY` это значение поля `key` из объекта `Facet`. Например, если мы хотим получить выборку продуктов, состоящую только из "Зеленого чая", в параметрах запроса надо передать следующее значение: `filter[property][]=3`.

### Параметры запроса

Параметр | Обязательный | Описание
-------- | ------- | -----------
sid | Да | ID магазина
tid | Да | ID категории
page | - | Номер страницы
filter[#{KEY}][] | - | Значение фильтра

<aside class="notice">
API обратно совместимо со старой версией API и поддерживает параметр rid - идентификатор ритейлера
</aside>


## Карточка продукта

```shell
curl "<%= config[:host] %>/products/6"
```

> Команда выше возвращает JSON:

```json
{
  "product": {
    "id": 1,
    "sku": "10001",
    "name": "Бананы",
    "price": 54.79,
    "original_price": 55.79,
    "discount": 1.0,
    "items_per_pack": 1,
    "human_volume": "500 г.",
    "weight": 500.0,
    "description": "Бананы желтые из Эквадора",
    "properties": [
      {
        "name": "energy_value",
        "presentation": "Калорийность",
        "value": "96"
      }
    ],
    "images": [
      {
        "mini_url": "http://instamart.ru/products/6/mini/file.png",
        "small_url": "http://instamart.ru/products/6/small/file.png",
        "product_url": "http://instamart.ru/products/6/product/file.png"
      }
    ],
    "related_products": [
      {
        "id": 2,
        "name": "Бананы мини",
        "price": 1.79,
        "original_price": 1.99,
        "discount": 0.20,
        "weight": 500.0,
        "items_per_pack": 1,
        "human_volume": "500 г.",
        "description": "Бананы мини",
        "properties": [...],
        "images": [...]
      }
    ]
  }
}
```

Получить данные для карточки продукта, можно выполнив запрос

### HTTP запрос

`GET <%= config[:host] %>/products/#{PRODUCT_ID}`

### Параметры запроса

Параметр | Обязательный | Описание
--------- | ------- | -----------
product_id | Да | ID продукта

