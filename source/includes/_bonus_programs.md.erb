# Бонусные программы

## API возможных типов бонусных карт

```shell
curl "<%= config[:host] %>/bonus_programs" \
  -H "Authorization: Token token=#{TOKEN}"
```

> Ответ будет содержать следующие данные:

```json
  {
    "bonus_programs": [{
      "id": 1,
      "name": "«Аэрофлот Бонус»",
      "icon": {
        "url": "https://<%= config[:host] %>/public/loyalty_cards_logos/16/mini/aero-img.png"
      }
    }]
  }
```

Получить список доступных бонусных программ можно, выполнив запрос:

`GET <%= config[:host] %>/bonus_programs`

Вернется массив доступных бонусных программ следующей структуры:

Параметр|Описание
---|---
id|Идентификатор бонусной программы
name|Наименование бонусной программы
icon|Логотип бонусной программы

## API просмотра и добавления бонусных карт

```shell
curl "<%= config[:host] %>/bonus_cards" \
  -H "Authorization: Token token=#{TOKEN}"
```
> Ответ будет содержать следующие данные:

```json
  {
    "bonus_cards": [{
      "points": null,
      "bonus_card": {
        "id": 121,
        "number": "1234567890",
        "bonus_program_id": 1
       }
    }]
  }
```

Получить список доступных бонусных карт можно, выполнив запрос:

`GET <%= config[:host] %>/bonus_cards`

Параметры ответа:

Параметр|Описание
---|---
points|Количество начисляемых баллов по карте
bonus_card|Описание бонусной карты

<aside class="notice">
Значение `null` для параметра `points` означает, что данные по количеству начисляемых бонусов
по карте не доступно
</aside>

Структура объекта bonus_card:

Параметр|Описание
---|---
id|Идентификатор бонусной карты
number|Номер бонусной карты
bonus_program_id|Идентификатор бонусной программы

### Добавление бонусной карты

```shell
curl "<%= config[:host] %>/bonus_cards" \
  -H "Authorization: Token token=#{TOKEN}"
  -X POST
  -d "bonus_program_id=1"
  -d "number=12341234"
```
> Ответ будет содержать следующие данные:

```json
  {
    "bonus_card": {
      "id": 121,
      "number": "1234567890",
      "bonus_program_id": 1
    }
  }
```
Для добавление новой бонусной карты необходимо выполнить запрос:

`POST <%= config[:host] %>/bonus_cards`

Параметры запроса:

Параметр|Обязательный|Описание
---|---
number|Да|Номер бонусной карты
bonus_program_id|Да|Идентификатор бонусной программы

Параметры ответа:

Параметр|Описание
---|---
id|Идентификатор бонусной карты
number|Номер бонусной карты
bonus_program_id|Идентификатор бонусной программы

### Обновление данных бонусной карты

```shell
curl "<%= config[:host] %>/bonus_cards/123" \
  -H "Authorization: Token token=#{TOKEN}"
  -X PUT
  -d "number=12341234"
```
> Ответ будет содержать следующие данные:

```json
  {
    "bonus_card": {
      "id": 121,
      "number": "1234567890",
      "bonus_program_id": 1
    }
  }
```
Для обновления данных бонусной карты необходимо выполинть запрос:

`PUT <%= config[:host] %>/bonus_cards/#{id}`

Параметры запроса:

Параметр|Обязательный|Описание
---|---
id|Да|Идентификатор бонусной карты
number|Нет|Номер бонусной карты
bonus_program_id|Нет|Идентификатор бонусной программы

Параметры ответа:

Параметр|Описание
---|---
id|Идентификатор бонусной карты
number|Номер бонусной карты
bonus_program_id|Идентификатор бонусной программы

### Удаление бонусной карты

```shell
curl "<%= config[:host] %>/bonus_cards/123" \
  -H "Authorization: Token token=#{TOKEN}"
  -X DELETE
```

> Ответ вернет результат с кодом 200

Чтобы удалить бонусную карту пользователя необходимо выполнить запрос:

`DELETE <%= config[:host] %>/bonus_cards/#{id}`

Параметры запроса:

Параметр|Обязательный|Описание
---|---
id|Да|Идентификатор бонусной карты

## API для получения карт и типов карт, которые можно применить к заказу

```shell
curl "<%= config[:host] %>/bonus_cards?order_number=R123456" \
  -H "Authorization: Token token=#{TOKEN}"
```
> Ответ будет содержать следующие данные:

```json
  {
    "bonus_cards": [{
      "points": "12 миль",
      "bonus_card": {
        "id": 121,
        "number": "1234567890",
        "bonus_program_id": 1
       }
    }]
  }
```

Получить список бонусных карт, которые могут быть применены к заказу можно, выполнив запрос:

`GET <%= config[:host] %>/bonus_cards?order_number=#{order_number}`

Параметры запроса:

Параметр|Обязательный|Описание
---|---
order_number|Да|Номер заказа

Параметры ответа:

Параметр|Описание
---|---
points|Количество начисляемых баллов по карте
bonus_card|Описание бонусной карты

<aside class="notice">
Значение `null` для параметра `points` означает, что данные по количеству начисляемых бонусов
по карте не доступно
</aside>

Структура объекта bonus_card:

Параметр|Описание
---|---
id|Идентификатор бонусной карты
number|Номер бонусной карты
bonus_program_id|Идентификатор бонусной программы

### Список бонусных программ, которые могу быть применены к данному заказу:

```shell
curl "<%= config[:host] %>/bonus_programs?order_number=R1234567" \
  -H "Authorization: Token token=#{TOKEN}"
```

> Ответ будет содержать следующие данные:

```json
  {
    "bonus_programs": [{
      "id": 1,
      "name": "«Аэрофлот Бонус»",
      "icon": {
        "url": "https://<%= config[:host] %>/public/loyalty_cards_logos/16/mini/aero-img.png"
      }
    }]
  }
```

Получить список бонусных программ, которые могут быть применены к заказу, можно, выполнив запрос:

`GET <%= config[:host] %>/bonus_programs?order_number=#{order_number}`

Параметры запроса:

Параметр|Обязательный|Описание
---|---
order_number|Да|Номер заказа

Вернется массив бонусных программ следующей структуры:

Параметр|Описание
---|---
id|Идентификатор бонусной программы
name|Наименование бонусной программы
icon|Логотип бонусной программы

## API применения карт к заказу

При совершении заказа, пользователь может выбрать одну из бонусных программ для начисления бонусов при покупке.

### Получение данных по бонусной карте, которая будет применена к заказу:

```shell
curl "<%= config[:host] %>/order/R010203/bonus_card_action" \
  -H "Authorization: Token token=#{TOKEN}"
```
> Ответ будет содержать следующие данные:

```json
  {
    "points": "201 миля",
    "bonus_card": {
      "id": 121,
      "number": "1234567890",
      "bonus_program_id": 1
    }
  }
```

Получить выбранную бонусную карту пользователя можно, выполнив запрос:

`GET <%= config[:host] %>/order/#{number}/bonus_card_action`

Параметры запроса:

Параметр|Обязательный|Описание
---|---
number|Да|Номер заказа

Параметры ответа:

Параметр|Описание
---|---
points|Количество начисляемых баллов по карте
bonus_card|Описание бонусной карты

Структура объекта bonus_card:

Параметр|Описание
---|---
id|Идентификатор бонусной карты
number|Номер бонусной карты
bonus_program_id|Идентификатор бонусной программы

### Выбор бонусной карты, которая бедет применена к заказу

```shell
curl "<%= config[:host] %>/order/R010203/bonus_card_action" \
  -H "Authorization: Token token=#{TOKEN}"
  -X POST
  -d "bonus_card_id=123"
```
> Ответ будет содержать следующие данные:

```json
  {
    "points": "201 миля",
    "bonus_card": {
      "id": 121,
      "number": "1234567890",
      "bonus_program_id": 1
    }
  }
```

Для того, чтобы выбрать бонусную карту, которая должна быть применена к заказу,
необходимо выполнить запрос:

`POST <%= config[:host] %>/order/#{number}/bonus_card_action`

Параметры запроса:

Параметр|Обязательный|Описание
---|---
number|Да|Номер заказа
bonus_card_id|Идентификатор бонусной карты

Параметры ответа:

Параметр|Описание
---|---
points|Количество начисляемых баллов по карте
bonus_card|Описание бонусной карты

Структура объекта bonus_card:

Параметр|Описание
---|---
id|Идентификатор бонусной карты
number|Номер бонусной карты
bonus_program_id|Идентификатор бонусной программы

<aside class="notice">
К заказу может быть применена только одна бонусная карта
</aside>

### Отмена выбора бонусной карты

```shell
curl "<%= config[:host] %>/order/R010203/bonus_card_action" \
  -H "Authorization: Token token=#{TOKEN}"
  -X DELETE
```

> Ответ вернет результат с кодом 200

Для отмены применения бонусной карты необходимо выполнить запрос:

`DELETE <%= config[:host] %>/order/#{number}/bonus_card_action`

Параметры запроса:

Параметр|Обязательный|Описание
---|---
number|Да|Номер заказа
