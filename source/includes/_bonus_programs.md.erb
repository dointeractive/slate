# Бонусные программы

## Список бонусных программ

При совершении заказа, пользователь может выбрать одну из бонусных программ для начисления бонусов при покупке.

```shell
curl "<%= config[:host] %>/orders/#{NUMBER}/bonus_programs" \
  -H "Authorization: Token token=#{TOKEN}"
```

> Ответ будет содержать следующие данные:

```json
{
   "loyalty_programs":[
      {
         "id": 1,
         "name": "«Аэрофлот Бонус»",
         "bonus_card": {
           "bonus": "21 миля",
           "number": "12345678"
         },
         "logos": [
           {
             "mini_url": "https://<%= config[:host] %>/public/loyalty_cards_logos/16/mini/aero-img.png",
             "small_url": "https://<%= config[:host] %>/public/loyalty_cards_logos/16/small/aero-img.png"
           }
         ],
         "default": true
      },
      {
         "id": 2,
         "name": "Связной клуб",
         "bonus_card": null,
         "logos": [
           {
             "mini_url": "https://<%= config[:host] %>/public/loyalty_cards_logos/11/mini/sclub-img.png",
             "small_url": "https://<%= config[:host] %>/public/loyalty_cards_logos/11/small/sclub-img.png"
           }
         ],
         "default": false
      }
   ]
}
```

<aside class="warning">
  not implemented
</aside>

Получить список доступных бонусных программ можно, выполнив запрос:

`GET <%= config[:host] %>/orders/#{NUMBER}/bonus_programs`

Параметр|Обязательный|Описание
---|----|----
NUMBER|Да|Номер заказа

Структура ответа

Параметр|Описание
---|---
id|Идентификатор бонусной программы
name|Наименование бонусной программы
logos|Список логотипов
bonus_card|Объект с описанием бонусной карты
default|Показывает, какая бонусная программа должна быть выбрана по-умолчанию

Объект `bonus_card`

Параметр|Описание
---|---
number|Номер бонусной карты
bonus|Начисляемые бонусы

## Выбор активной бонусной программы

```shell
curl "<%= config[:host] %>/orders/#{NUMBER}/bonus_programs/#{ID}" \
  -H "Authorization: Token token=#{TOKEN}"
  -X PUT \
```

> В случае успешного запроса сервер вернет пустой ответ с кодом 200

<aside class="warning">
  not implemented
</aside>

Перед завершением заказа необходимо выбрать, какую бонусную программу нужно использовать для этого заказа. Если у пользователя нет бонусных карт, то запрос не нужен.

Выбрать применяемую бонусную программу можно, выполнив запрос:

`PUT <%= config[:host] %>/orders/#{NUMBER}/bonus_programs/#{ID}`

Параметр | Обязательный | Описание
--------- | ------- | -----------
NUMBER | Номер заказа
ID | Да | Идентификатор бонусной программы

## Запрос на добавление/изменение бонусной карты

```shell
curl "<%= config[:host] %>/orders/#{NUMBER}/bonus_programs/#{ID}/bonus_card" \
  -H "Authorization: Token token=#{TOKEN}"
  -d "bonus_card[number]=12341234" \
  -X POST
```

> Ответ будет содержать следующие данные:

```json
{
   "bonus_card": {
     "number": "12341234",
     "bonus": "21 миля"
   }
}
```

Добавить/изменить номер бонусной карты пользователя можно, выполнив запрос:

<aside class="warning">
  not implemented
</aside>

`POST <%= config[:host] %>/orders/#{NUMBER}/bonus_programs/#{ID}/bonus_card`

Параметр | Обязательный | Описание
--------- | ------- | -----------
bonus_card[number]|Да|Номер бонусной карты
NUMBER | Номер заказа
ID | Да | Идентификатор бонусной программы

## Запрос на удаление бонусной карты

```shell
curl "<%= config[:host] %>/orders/#{NUMBER}/bonus_programs/#{ID}/bonus_card" \
  -H "Authorization: Token token=#{TOKEN}" \
  -X DELETE
```

> В случае успешного удаления сервер вернет пустой ответ с кодом 200

<aside class="warning">
  not implemented
</aside>

Удалить бонусную карту пользователя можно, выполнив запрос:

`DELETE <%= config[:host] %>/bonus_cards/#{ID}`

Параметр | Обязательный | Описание
--------- | ------- | -----------
NUMBER|Да|Номер заказа
ID | Да | Идентификатор бонусной программы
