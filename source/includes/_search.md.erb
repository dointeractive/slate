# Поиск

## Подсказки поиска

> Пример запроса подсказок, для слова "чай"

```shell
curl '<%= config[:host] %>/searches/suggestions?rid=1&q=%D1%87%D0%B0%D0%B9'
```
> Ответ будет содержать следующие данные

```json
{
  "suggestion": {
    "taxons": [
      {
        "id": 3,
        "name": "Чай"
      }
    ],
    "products": [
      {
        "id": 1,
        "name": "Чай Lipton Yellow Label",
        "price": 42,
        "sku": "33688"
      }
    ]
  }
}
```

Для получения списка подсказок поиска, выполните запрос:

`GET <%= config[:host] %>/searches/suggestions`

### Параметры запроса

Параметр | Обязательный | Описание
--------- | ------- | -----------
`rid` | Да | ID ритейлера, по которому происходит поиск
`q` | Да | Поисковая фраза

## Результаты поиска

> Пример запроса результатов поиска, для слова "чай"

```shell
curl '<%= config[:host] %>/searches?rid=1&q=%D1%87%D0%B0%D0%B9'
```
> Ответ будет содержать продукты, сгруппированные по категориям:

```json
{
  "results": [{
    "name": "Чай",
    "products_count": 324,
    "taxon_id": 187,
    "products": [{
      "id": 6560,
      "sku": "16563",
      "name": "Чай черный Greenfield Golden Ceylon цейлонский пакетированный",
      "price": 309.34,
      "original_price": 309.34,
      "discount": 0.0,
      "weight": 200.0,
      "items_per_pack": 1,
      "human_volume": "100 пак.",
      "images": [{
        "mini_url": "http://instamart.ru/spree/products/8161/mini/16563.jpg?1473242827",
        "small_url": "http://instamart.ru/spree/products/8161/small/16563.jpg?1473242827",
        "product_url": "http://instamart.ru/spree/products/8161/product/16563.jpg?1473242827"
      }]
    }]
  }],

  "facets": [{
    "key": "brand",
    "name": "Бренд",
    "type": "select",
    "options": [
      {
        "name": "Ahmad Tea",
        "value": 1,
        "active": false
      }
    ]
  }, {
    "key": "country",
    "name": "Страна",
    "type": "select",
    "options": [
      {
        "name": "Индия",
        "value": 1,
        "active": false
      }
    ]
  }],

  "meta": {
    "current_page": 1,
    "next_page": null,
    "total_pages": 1
  }
}
```

> Пример поискового запроса с фильтрацией результатов:

```shell
curl '<%= config[:host] %>/searches?rid=1&q=%D1%87%D0%B0%D0%B9' \
  -X GET \
  -d filter[brand][]=1 \
  -d filter[property][]=4 \
  -d filter[property][]=7
```

Для получения результатов поиска, выполните запрос:

`GET <%= config[:host] %>/searches`

### Структура ответа

Объект | Описание
--------- | -----------
results | Список результатов
facets | Список фасетов для фильтрации результатов поиска
meta | Атрибуты пагинации

### Структура объекта Facet

API поиска поддерживает фасетную фильтрацию результатов. То есть поисковая выборка может быть скорректирована применением фильтров. Данные необходимые для корректного отображения фасета хранятся в объекте Facet.

Атрибут | Описание
--------- | -----------
key | Имя параметра в запросе
name | Название фасета
type | Тип, определяющий вид контрола: селект, мультиселект, интервал и т.п.
options | Список значений фасета для фильтрации

На данный момент доступны следующие типы фасетов:

Тип | Описание
----- | ------
select | Выбор одного значение из множества
multi_select | Выбор множества значений

### Фильтрация поисковой выдачи

Фильтрация выполняется передачей значения фасета в параметрах запроса.

Название параметра запроса формируется по шаблону `filter[#{FACET_KEY}][]`, где `FACET_KEY` это значение поля `key` из объекта `Facet`. Например, если мы хотим ограничить поиск только продуктами бренда "Ahmad", то в параметрах запроса надо передать следующее значение: `filter[brand][]=1`.

### Параметры запроса

Параметр | Обязательный | Описание
--------- | ------- | -----------
`rid` | Да | ID ритейлера, по которому происходит поиск
`q` | Да | Поисковая фраза
`page` | -- | Номер страницы с группами (по умолчанию 1)
filter[#{KEY}][] | -- | Значение фильтра
